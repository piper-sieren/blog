<!DOCTYPE html>
<html lang="en"><head>
    <title>Piper Williams | Blog</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://piperwilliams.work//favicon.ico">
    <link rel="canonical" href="https://piperwilliams.work/">
    
    
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://piperwilliams.work/">Piper Williams | Blog</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/posts/">
                                    internal
                                    <span>Posts</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/categories/">
                                    internal
                                    <span>Categories</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/tags/">
                                    internal
                                    <span>Tags</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/about/">
                                    internal
                                    <span>About</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="">
                                    
                                    <span></span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="">
                                    
                                    <span></span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="">
                                    
                                    <span></span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>Azure Blob Storage &#43; .NET Client Library - Sun, Feb 21, 2021</h1>
    </div>
    <p class="lead">Azure Blob Storage &#43; .NET Client Library</p>
    <p>Azure offers Blob Storage as the cloud storage solution. Blob Storage is a way of storing substantial amounts of unstructured data: data that doesn&rsquo;t adhere to a specific data model or definition- data that can&rsquo;t go into rows and columns. For example, video, audio, image, log files, text files, etc. Azure Blob Storage has three types of resources to offer:</p>
<ol>
<li>The Storage Account</li>
<li>Container(s) within the storage account</li>
<li>Blob(s) within the Container</li>
</ol>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>Azure Subscription</li>
<li>Azure Storage Account</li>
<li>The current .Net Core SDK for your OS</li>
</ol>
<p>First, you will need to set up a .NET Core project. Do this with whichever method you please. I typically use Visual Studios, but some prefer doing this directly in their Terminal of choice.</p>
<p>Next, you will need to connect your Storage Account to your .NET Core project. Do this by generating an Access Key inside your Azure Storage Account. Copy the &ldquo;Connection String&rdquo; value generated for key1.</p>
<p>Then, set this value as an environment variable named &ldquo;AZURE_STORAGE_CONNECTION_STRING&rdquo;. An easy way to set an environment variable without navigating through your system settings is to use your OS Command Prompt. For windows, that would be the CMD with the following syntax:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">set AZURE_STORAGE_CONNECTION_STRING <span class="p">&lt;</span><span class="nt">yourconnectionstring</span><span class="p">&gt;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p><img src="https://static.wixstatic.com/media/6a8247_b6f9eef8b5844201a844e0a4d3e8ba06~mv2.png/v1/fill/w_998,h_262,al_c,lg_1,q_85,enc_auto/6a8247_b6f9eef8b5844201a844e0a4d3e8ba06~mv2.png" alt="image info"></p>
<p>.Net classes to interact with Azure Storage Resources</p>
<p><strong>BlobServiceClient:</strong> manipulate Azure Storage resources and blob containers</p>
<p><strong>BlobContainerClient:</strong> manipulate Azure Storage containers and their blobs</p>
<p><strong>BlobClient:</strong> manipulate Azure Storage Blobs</p>
<p><strong>BlobDownloadInfo:</strong> Represent the properties and content returned from downloading a Blob</p>
<h4 id="tip">Tip:</h4>
<p>Retrieve the Azure Storage Account&rsquo;s Connection String inside your .NET</p>
<p>project- From your previously set environment variables.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">string connectionString = Environment.GetEnvironmentVariable(&#34;AZURE_STORAGE_CONNECTION_STRING&#34;);</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 id="tip-1">Tip:</h4>
<p>Add the Azure Blob Storage .Net Client Library with the using statement.
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">using Azure.Storage;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">using Azure.Storage.Blobs;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">using Azure.Storage.Blobs.Models;</span></span></code></pre></td></tr></table>
</div>
</div></p>
<h2 id="code-examples">Code Examples:</h2>
<h4 id="retrieve-the-azure-store-accounts-connection-string--environment-variable">Retrieve the Azure Store Account’s Connection String – Environment Variable:</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">string connectionString = Environment.GetEnvironmentVariable(&#34;AZURE_STORAGE_CONNECTION_STRING&#34;);</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 id="list-blobs-in-a-container">List Blobs in a Container:</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">BlobContainerClient blobContainerClient = new BlobContainerClient(connectionString, &#34;burpgrid&#34;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Console.WriteLine(&#34;Listing blobs...&#34;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">var blobnames = new List<span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;</span>();
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// List all blobs in the container
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">await foreach (BlobItem blobItem in blobContainerClient.GetBlobsAsync())
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Console.WriteLine(&#34;\t&#34; + blobItem.Name);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">blobnames.Add(blobItem.Name);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 id="download-contents-from-each-blob-in-a-container-to-local">Download Contents from each Blob in a Container to Local:</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">foreach (string blobname in blobnames)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">string localFilePath = Path.Combine(localPath, blobname);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Connect to each blob client
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">BlobClient blobClient = blobContainerClient.GetBlobClient(blobname);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Download the blob&#39;s contents and save it to a file
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">BlobDownloadInfo download = await blobClient.DownloadAsync();
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">using (FileStream downloadFileStream = File.OpenWrite(localFilePath))
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">await download.Content.CopyToAsync(downloadFileStream);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">downloadFileStream.Close();
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 id="clear-local-file-path">Clear Local File Path:</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">//Delete all files in local file path
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">string localPath = “/.data/”
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">string[] filePaths = Directory.GetFiles(localPath);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">foreach (string filePath in filePaths)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">File.Delete(filePath);</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 id="open-and-read-file-contents-to-class">Open and Read File Contents to Class:</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">//Open and read files 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">foreach (string blobname in blobnames)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">string localFilePath = Path.Combine(localPath, blobname);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">string text = System.IO.File.ReadAllText(localFilePath);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> //Convert to saved JSON
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> var scan = JsonConvert.DeserializeObject<span class="p">&lt;</span><span class="nt">ScanResults</span><span class="p">&gt;</span>(text);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Console.WriteLine(&#34;issue counts: &#34; + scan.issue_counts.total);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Console.WriteLine(&#34;site name: &#34; + scan.site_name);
</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="additional-resources">Additional resources:</h2>
<ol>
<li>
<p><a href="https://learn.microsoft.com/en-us/dotnet/api/azure.storage.blobs?view=azure-dotnet">API reference documentation</a></p>
</li>
<li>
<p><a href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/storage/Azure.Storage.Blobs">Library source code</a></p>
</li>
<li>
<p><a href="https://www.nuget.org/packages/Azure.Storage.Blobs">Package (NuGet)</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-samples-dotnet?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json#blob-samples">Samples</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-quickstart-blobs-dotnet">Microsoft Documentation</a></p>
</li>
</ol>

    <h4><a href="https://piperwilliams.work/">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>
&copy; 

    

<span id="thisyear">2023</span>


</p>
    <p class="text-center">
        
        
        
        
        
    </p>
</footer>

</body><link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/style.css">

<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: null ,
        onePass: null , 
        speedFactor: null 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script>
</html>
